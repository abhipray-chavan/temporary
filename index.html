<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NTU GPA Calculator | Graduate Students</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --ntu-red: #C41E3A;
            --ntu-dark: #8B0000;
            --bg-primary: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #1a1a2e;
            --text-secondary: #6c757d;
            --border-color: #e9ecef;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(196, 30, 58, 0.3); }
            50% { box-shadow: 0 0 20px rgba(196, 30, 58, 0.6); }
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--ntu-red) 0%, var(--ntu-dark) 100%);
            color: white;
            margin-bottom: 30px;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 20px rgba(196, 30, 58, 0.3);
            animation: fadeInUp 0.6s ease-out;
        }

        header h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        header p {
            opacity: 0.9;
            font-size: 1rem;
            animation: fadeIn 0.8s ease-out 0.4s both;
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            animation: fadeInUp 0.5s ease-out;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .grading-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .grading-table th,
        .grading-table td {
            padding: 10px 12px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s;
        }

        .grading-table th {
            background: var(--bg-primary);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .grading-table tr:last-child td {
            border-bottom: none;
        }

        .grading-table tr:hover td {
            background: linear-gradient(135deg, #fff5f7 0%, #ffe8ec 100%);
        }

        .course-entry {
            display: grid;
            grid-template-columns: 1fr 100px 120px 40px;
            gap: 12px;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            animation: slideInLeft 0.4s ease-out;
        }

        .course-entry:last-of-type {
            border-bottom: none;
        }

        input, select {
            padding: 10px 14px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--ntu-red);
            box-shadow: 0 0 0 3px rgba(196, 30, 58, 0.1);
            transform: scale(1.02);
        }

        input[type="number"] {
            text-align: center;
        }

        select {
            cursor: pointer;
            background: white;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .btn:active::after {
            width: 200px;
            height: 200px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--ntu-red) 0%, var(--ntu-dark) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 20px rgba(196, 30, 58, 0.4);
        }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: none;
            color: var(--danger);
            padding: 8px;
            font-size: 1.2rem;
        }

        .btn-danger:hover {
            background: #fee;
            border-radius: 50%;
            transform: rotate(90deg);
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .result-box {
            text-align: center;
            padding: 24px;
            background: var(--bg-primary);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .result-box:hover {
            transform: scale(1.05);
        }

        .result-box.primary {
            background: linear-gradient(135deg, var(--ntu-red) 0%, var(--ntu-dark) 100%);
            color: white;
            animation: pulse 2s infinite;
        }

        .result-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 4px;
            transition: all 0.3s ease;
        }

        .result-value.updated {
            animation: bounce 0.5s ease;
        }

        .result-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.8;
        }

        .classification {
            margin-top: 16px;
            padding: 16px;
            background: var(--bg-primary);
            border-radius: 12px;
            text-align: center;
        }

        .classification-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .classification-badge:hover {
            transform: scale(1.1);
        }

        .first-class {
            background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%);
            color: #5a4800;
            animation: glow 2s infinite;
        }

        .second-upper {
            background: linear-gradient(135deg, #c0c0c0 0%, #a8a8a8 100%);
            color: #404040;
        }

        .second-lower {
            background: linear-gradient(135deg, #cd7f32 0%, #b87333 100%);
            color: white;
        }

        .third-class {
            background: #6c757d;
            color: white;
        }

        .pass {
            background: var(--success);
            color: white;
        }

        .fail {
            background: var(--danger);
            color: white;
        }

        .info-note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px 16px;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
            margin-top: 16px;
            animation: fadeIn 0.5s ease-out;
        }

        .info-note strong {
            color: #856404;
        }

        footer {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            animation: fadeIn 1s ease-out;
        }

        footer a {
            color: var(--ntu-red);
            text-decoration: none;
            transition: color 0.3s;
        }

        footer a:hover {
            text-decoration: underline;
            color: var(--ntu-dark);
        }

        #no-courses {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .hidden {
            display: none;
        }

        /* Grade Explorer Styles */
        .explorer-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 2px dashed var(--border-color);
        }

        .explorer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .explorer-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .explorer-title span {
            animation: bounce 1s infinite;
        }

        .explorer-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .explorer-input {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .explorer-input label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .explorer-input input {
            width: 70px;
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .generate-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .combinations-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 16px;
        }

        @media (max-width: 768px) {
            .combinations-grid {
                grid-template-columns: 1fr;
            }
        }

        .combo-category {
            background: var(--bg-primary);
            border-radius: 12px;
            overflow: hidden;
            animation: fadeInUp 0.5s ease-out;
        }

        .combo-category-header {
            padding: 16px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .combo-category-header:hover {
            filter: brightness(1.1);
        }

        .combo-category-header.best-header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .combo-category-header.mid-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .combo-category-header.low-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .combo-category-icon {
            font-size: 1.5rem;
            animation: bounce 2s infinite;
        }

        .combo-category-info h4 {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .combo-category-info p {
            font-size: 0.75rem;
            opacity: 0.9;
        }

        .combo-count {
            margin-left: auto;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .combo-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 8px;
        }

        .combo-card {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .combo-card:hover {
            transform: translateX(5px);
            border-color: var(--ntu-red);
            box-shadow: 0 4px 15px rgba(196, 30, 58, 0.2);
        }

        .combo-card.selected {
            border-color: var(--ntu-red);
            background: linear-gradient(135deg, #fff5f7 0%, #ffe8ec 100%);
            animation: pulse 1s;
        }

        .combo-cgpa {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--ntu-red);
            margin-bottom: 8px;
        }

        .combo-grades {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .combo-grade-chip {
            background: linear-gradient(135deg, var(--bg-primary) 0%, #e9ecef 100%);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .combo-grade-chip:hover {
            transform: scale(1.1);
            background: linear-gradient(135deg, var(--ntu-red) 0%, var(--ntu-dark) 100%);
            color: white;
        }

        .combo-apply-btn {
            width: 100%;
            padding: 8px;
            background: linear-gradient(135deg, var(--ntu-red) 0%, var(--ntu-dark) 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(10px);
        }

        .combo-card:hover .combo-apply-btn {
            opacity: 1;
            transform: translateY(0);
        }

        .combo-apply-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(196, 30, 58, 0.3);
        }

        .no-combos {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
        }

        .total-combos {
            text-align: center;
            margin-top: 16px;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            color: white;
            font-weight: 600;
            animation: shimmer 3s linear infinite;
            background-size: 200% 100%;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            header {
                padding: 30px 16px;
                border-radius: 0 0 16px 16px;
            }

            header h1 {
                font-size: 1.5rem;
            }

            .container {
                padding: 12px;
            }

            .card {
                padding: 16px;
                border-radius: 12px;
            }

            .course-entry {
                grid-template-columns: 1fr auto;
                gap: 8px;
            }

            .course-entry input[type="text"] {
                grid-column: 1 / -1;
            }

            input, select {
                padding: 12px 10px;
                font-size: 16px;
            }

            .results {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .result-value {
                font-size: 2rem;
            }

            .explorer-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .explorer-controls {
                width: 100%;
                flex-wrap: wrap;
            }

            .button-group {
                flex-direction: column;
            }

            .button-group .btn {
                width: 100%;
                text-align: center;
            }

            .table-wrapper {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin: 0 -16px;
                padding: 0 16px;
            }

            .grading-table {
                font-size: 0.75rem;
                min-width: 500px;
            }
        }

        @media (max-width: 480px) {
            header h1 {
                font-size: 1.3rem;
            }

            .course-entry {
                grid-template-columns: 1fr 1fr;
            }

            .course-entry input[type="text"] {
                grid-column: 1 / -1;
            }

            .course-entry input[type="number"],
            .course-entry select {
                width: 100%;
            }

            .course-entry .btn-danger {
                grid-column: 1 / -1;
                width: 100%;
                padding: 10px;
                background: #fee;
                border-radius: 8px;
            }

            .result-value {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>NTU GPA Calculator</h1>
        <p>Graduate Studies | Masters in AI</p>
    </header>

    <div class="container">
        <!-- Grading Reference -->
        <div class="card" style="animation-delay: 0.1s;">
            <h2 class="card-title">NTU Grading Scale (5.0 System)</h2>
            <div class="table-wrapper">
                <table class="grading-table">
                    <thead>
                        <tr>
                            <th>Grade</th>
                            <th>A+</th>
                            <th>A</th>
                            <th>A-</th>
                            <th>B+</th>
                            <th>B</th>
                            <th>B-</th>
                            <th>C+</th>
                            <th>C</th>
                            <th>D+</th>
                            <th>D</th>
                            <th>F</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Points</strong></td>
                            <td>5.0</td>
                            <td>5.0</td>
                            <td>4.5</td>
                            <td>4.0</td>
                            <td>3.5</td>
                            <td>3.0</td>
                            <td>2.5</td>
                            <td>2.0</td>
                            <td>1.5</td>
                            <td>1.0</td>
                            <td>0.0</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Course Input -->
        <div class="card" style="animation-delay: 0.2s;">
            <h2 class="card-title">Your Courses</h2>

            <div id="courses-container">
                <div id="no-courses">
                    <p>No courses added yet. Click "Add Course" to get started.</p>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="addCourse()">+ Add Course</button>
                <button class="btn btn-secondary" onclick="clearAll()">Clear All</button>
            </div>

            <div class="info-note">
                <strong>Note:</strong> For Masters programmes, each course typically carries 3 AUs.
                The Dissertation Project carries 6 AUs but is not included in GPA calculation.
                Minimum CGPA of 2.50 is required for graduation.
            </div>
        </div>

        <!-- Results -->
        <div class="card" id="results-card" style="animation-delay: 0.3s;">
            <h2 class="card-title">Your Results</h2>

            <div class="results">
                <div class="result-box primary">
                    <div class="result-value" id="cgpa">0.00</div>
                    <div class="result-label">CGPA</div>
                </div>
                <div class="result-box">
                    <div class="result-value" id="total-au">0</div>
                    <div class="result-label">Total AUs</div>
                </div>
                <div class="result-box">
                    <div class="result-value" id="total-courses">0</div>
                    <div class="result-label">Courses</div>
                </div>
            </div>

            <div class="classification">
                <p style="margin-bottom: 8px; color: var(--text-secondary); font-size: 0.9rem;">Degree Classification</p>
                <span class="classification-badge" id="classification">N/A</span>
            </div>

            <!-- Grade Explorer Section -->
            <div class="explorer-section">
                <div class="explorer-header">
                    <div class="explorer-title">
                        <span>ðŸŽ¯</span> Grade Combination Explorer
                    </div>
                    <div class="explorer-controls">
                        <div class="explorer-input">
                            <label>Courses:</label>
                            <input type="number" id="explore-courses" min="1" max="4" value="2">
                        </div>
                        <div class="explorer-input">
                            <label>AU each:</label>
                            <input type="number" id="explore-au" min="1" max="6" value="3">
                        </div>
                        <button class="generate-btn" onclick="generateAllCombinations()">
                            Generate All
                        </button>
                    </div>
                </div>

                <div id="combinations-container"></div>
            </div>
        </div>

        <!-- Degree Classification Reference -->
        <div class="card" style="animation-delay: 0.4s;">
            <h2 class="card-title">Degree Classification</h2>
            <div class="table-wrapper">
                <table class="grading-table classification-table">
                    <thead>
                        <tr>
                            <th>Classification</th>
                            <th>CGPA Range</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="classification-badge first-class">First Class Honours</span></td>
                            <td>4.50 - 5.00</td>
                        </tr>
                        <tr>
                            <td><span class="classification-badge second-upper">Second Class Upper</span></td>
                            <td>4.00 - 4.49</td>
                        </tr>
                        <tr>
                            <td><span class="classification-badge second-lower">Second Class Lower</span></td>
                            <td>3.50 - 3.99</td>
                        </tr>
                        <tr>
                            <td><span class="classification-badge third-class">Third Class</span></td>
                            <td>3.00 - 3.49</td>
                        </tr>
                        <tr>
                            <td><span class="classification-badge pass">Pass</span></td>
                            <td>2.50 - 2.99</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer>
        <p>This calculator is for reference only. For official GPA, please check your NTU transcript.</p>
        <p style="margin-top: 8px;">
            Reference: <a href="https://www.ntu.edu.sg/docs/default-source/office-of-academic-services/academic-handbook-(graduate-studies)-ay2024-25.pdf" target="_blank">NTU Academic Handbook for Graduate Studies AY 2024-25</a>
        </p>
    </footer>

    <script>
        // NTU Grade Points (5.0 scale)
        const gradePoints = {
            'A+': 5.0,
            'A': 5.0,
            'A-': 4.5,
            'B+': 4.0,
            'B': 3.5,
            'B-': 3.0,
            'C+': 2.5,
            'C': 2.0,
            'D+': 1.5,
            'D': 1.0,
            'F': 0.0
        };

        const gradeList = ['A+', 'A', 'A-', 'B+', 'B', 'B-', 'C+', 'C', 'D+', 'D', 'F'];
        let courseCount = 0;

        function addCourse() {
            const container = document.getElementById('courses-container');
            const noCourses = document.getElementById('no-courses');

            if (noCourses) {
                noCourses.classList.add('hidden');
            }

            courseCount++;
            const courseId = courseCount;

            const courseDiv = document.createElement('div');
            courseDiv.className = 'course-entry';
            courseDiv.id = `course-${courseId}`;
            courseDiv.innerHTML = `
                <input type="text" placeholder="Course Name (optional)" id="name-${courseId}">
                <input type="number" placeholder="AU" min="1" max="12" value="3" id="au-${courseId}" onchange="calculateGPA()">
                <select id="grade-${courseId}" onchange="calculateGPA()">
                    <option value="">Grade</option>
                    <option value="A+">A+</option>
                    <option value="A">A</option>
                    <option value="A-">A-</option>
                    <option value="B+">B+</option>
                    <option value="B">B</option>
                    <option value="B-">B-</option>
                    <option value="C+">C+</option>
                    <option value="C">C</option>
                    <option value="D+">D+</option>
                    <option value="D">D</option>
                    <option value="F">F</option>
                </select>
                <button class="btn btn-danger" onclick="removeCourse(${courseId})" title="Remove course">&times;</button>
            `;

            container.appendChild(courseDiv);
            calculateGPA();
        }

        function removeCourse(id) {
            const courseDiv = document.getElementById(`course-${id}`);
            if (courseDiv) {
                courseDiv.style.animation = 'fadeIn 0.3s ease-out reverse';
                setTimeout(() => {
                    courseDiv.remove();
                    const container = document.getElementById('courses-container');
                    const courses = container.querySelectorAll('.course-entry');
                    if (courses.length === 0) {
                        const noCourses = document.getElementById('no-courses');
                        if (noCourses) {
                            noCourses.classList.remove('hidden');
                        }
                    }
                    calculateGPA();
                }, 200);
            }
        }

        function clearAll() {
            const container = document.getElementById('courses-container');
            const courses = container.querySelectorAll('.course-entry');
            courses.forEach(course => course.remove());

            const noCourses = document.getElementById('no-courses');
            if (noCourses) {
                noCourses.classList.remove('hidden');
            }

            courseCount = 0;
            calculateGPA();
        }

        function calculateGPA() {
            const container = document.getElementById('courses-container');
            const courses = container.querySelectorAll('.course-entry');

            let totalPoints = 0;
            let totalAU = 0;
            let validCourses = 0;

            courses.forEach(course => {
                const id = course.id.split('-')[1];
                const au = parseFloat(document.getElementById(`au-${id}`).value) || 0;
                const grade = document.getElementById(`grade-${id}`).value;

                if (grade && au > 0) {
                    const points = gradePoints[grade];
                    totalPoints += points * au;
                    totalAU += au;
                    validCourses++;
                }
            });

            const cgpa = totalAU > 0 ? (totalPoints / totalAU) : 0;

            // Animate the update
            const cgpaEl = document.getElementById('cgpa');
            cgpaEl.classList.add('updated');
            setTimeout(() => cgpaEl.classList.remove('updated'), 500);

            document.getElementById('cgpa').textContent = cgpa.toFixed(2);
            document.getElementById('total-au').textContent = totalAU;
            document.getElementById('total-courses').textContent = validCourses;

            updateClassification(cgpa, validCourses);
        }

        function updateClassification(cgpa, courseCount) {
            const badge = document.getElementById('classification');

            if (courseCount === 0) {
                badge.textContent = 'N/A';
                badge.className = 'classification-badge';
                return;
            }

            if (cgpa >= 4.5) {
                badge.textContent = 'First Class Honours';
                badge.className = 'classification-badge first-class';
            } else if (cgpa >= 4.0) {
                badge.textContent = 'Second Class Upper';
                badge.className = 'classification-badge second-upper';
            } else if (cgpa >= 3.5) {
                badge.textContent = 'Second Class Lower';
                badge.className = 'classification-badge second-lower';
            } else if (cgpa >= 3.0) {
                badge.textContent = 'Third Class';
                badge.className = 'classification-badge third-class';
            } else if (cgpa >= 2.5) {
                badge.textContent = 'Pass';
                badge.className = 'classification-badge pass';
            } else {
                badge.textContent = 'Below Graduation Requirement';
                badge.className = 'classification-badge fail';
            }
        }

        function getCurrentTotals() {
            const container = document.getElementById('courses-container');
            const courses = container.querySelectorAll('.course-entry');

            let totalPoints = 0;
            let totalAU = 0;

            courses.forEach(course => {
                const id = course.id.split('-')[1];
                const au = parseFloat(document.getElementById(`au-${id}`).value) || 0;
                const grade = document.getElementById(`grade-${id}`).value;

                if (grade && au > 0) {
                    totalPoints += gradePoints[grade] * au;
                    totalAU += au;
                }
            });

            return { totalPoints, totalAU };
        }

        function getClassification(cgpa) {
            if (cgpa >= 4.5) return { name: 'First Class', class: 'first-class' };
            if (cgpa >= 4.0) return { name: 'Second Upper', class: 'second-upper' };
            if (cgpa >= 3.5) return { name: 'Second Lower', class: 'second-lower' };
            if (cgpa >= 3.0) return { name: 'Third Class', class: 'third-class' };
            if (cgpa >= 2.5) return { name: 'Pass', class: 'pass' };
            return { name: 'Below Req.', class: 'fail' };
        }

        function generateAllCombinations() {
            const numCourses = parseInt(document.getElementById('explore-courses').value) || 2;
            const auPerCourse = parseInt(document.getElementById('explore-au').value) || 3;
            const { totalPoints: currentPoints, totalAU: currentAU } = getCurrentTotals();

            // Limit combinations for performance
            const limitedGrades = ['A+', 'A', 'A-', 'B+', 'B', 'B-', 'C+', 'C'];

            // Generate all combinations
            const combinations = [];

            function generateCombos(current, depth) {
                if (depth === numCourses) {
                    const grades = [...current];
                    let newPoints = currentPoints;
                    let newAU = currentAU;

                    grades.forEach(g => {
                        newPoints += gradePoints[g] * auPerCourse;
                        newAU += auPerCourse;
                    });

                    const cgpa = newAU > 0 ? newPoints / newAU : 0;
                    combinations.push({ grades, cgpa });
                    return;
                }

                for (const grade of limitedGrades) {
                    current.push(grade);
                    generateCombos(current, depth + 1);
                    current.pop();
                }
            }

            generateCombos([], 0);

            // Sort by CGPA and categorize
            combinations.sort((a, b) => b.cgpa - a.cgpa);

            // Remove duplicates (same grades in different order)
            const unique = [];
            const seen = new Set();
            combinations.forEach(combo => {
                const key = [...combo.grades].sort().join(',');
                if (!seen.has(key)) {
                    seen.add(key);
                    unique.push(combo);
                }
            });

            // Categorize: Best (>=4.0), Mid (3.0-3.99), Low (<3.0)
            const best = unique.filter(c => c.cgpa >= 4.0).slice(0, 15);
            const mid = unique.filter(c => c.cgpa >= 3.0 && c.cgpa < 4.0).slice(0, 15);
            const low = unique.filter(c => c.cgpa < 3.0).slice(0, 15);

            renderCombinations(best, mid, low, unique.length);
        }

        function renderCombinations(best, mid, low, total) {
            const container = document.getElementById('combinations-container');

            const renderComboCard = (combo, index) => {
                const classification = getClassification(combo.cgpa);
                const gradesHTML = combo.grades.map(g =>
                    `<span class="combo-grade-chip">${g}</span>`
                ).join('');

                return `
                    <div class="combo-card" onclick="selectCombo(this)" style="animation-delay: ${index * 0.05}s">
                        <div class="combo-cgpa">
                            CGPA: ${combo.cgpa.toFixed(2)}
                            <span class="classification-badge ${classification.class}" style="font-size: 0.7rem; padding: 3px 8px; margin-left: 8px;">${classification.name}</span>
                        </div>
                        <div class="combo-grades">${gradesHTML}</div>
                        <button class="combo-apply-btn" onclick="event.stopPropagation(); applyCombo([${combo.grades.map(g => `'${g}'`).join(',')}])">
                            Apply This Combination
                        </button>
                    </div>
                `;
            };

            container.innerHTML = `
                <div class="combinations-grid">
                    <div class="combo-category">
                        <div class="combo-category-header best-header">
                            <span class="combo-category-icon">ðŸŒŸ</span>
                            <div class="combo-category-info">
                                <h4>Best Outcomes</h4>
                                <p>CGPA 4.0 and above</p>
                            </div>
                            <span class="combo-count">${best.length}</span>
                        </div>
                        <div class="combo-list">
                            ${best.length > 0 ? best.map((c, i) => renderComboCard(c, i)).join('') : '<div class="no-combos">No combinations in this range</div>'}
                        </div>
                    </div>

                    <div class="combo-category">
                        <div class="combo-category-header mid-header">
                            <span class="combo-category-icon">âš¡</span>
                            <div class="combo-category-info">
                                <h4>Mid Range</h4>
                                <p>CGPA 3.0 - 3.99</p>
                            </div>
                            <span class="combo-count">${mid.length}</span>
                        </div>
                        <div class="combo-list">
                            ${mid.length > 0 ? mid.map((c, i) => renderComboCard(c, i)).join('') : '<div class="no-combos">No combinations in this range</div>'}
                        </div>
                    </div>

                    <div class="combo-category">
                        <div class="combo-category-header low-header">
                            <span class="combo-category-icon">ðŸ“Š</span>
                            <div class="combo-category-info">
                                <h4>Lower Range</h4>
                                <p>CGPA below 3.0</p>
                            </div>
                            <span class="combo-count">${low.length}</span>
                        </div>
                        <div class="combo-list">
                            ${low.length > 0 ? low.map((c, i) => renderComboCard(c, i)).join('') : '<div class="no-combos">No combinations in this range</div>'}
                        </div>
                    </div>
                </div>

                <div class="total-combos">
                    Total unique combinations: ${total}
                </div>
            `;
        }

        function selectCombo(element) {
            document.querySelectorAll('.combo-card').forEach(card => card.classList.remove('selected'));
            element.classList.add('selected');
        }

        function applyCombo(grades) {
            grades.forEach((grade, index) => {
                addCourse();
                const newCourseId = courseCount;
                document.getElementById(`name-${newCourseId}`).value = `Future Course ${index + 1}`;
                document.getElementById(`grade-${newCourseId}`).value = grade;
            });

            calculateGPA();
            document.getElementById('results-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Initialize
        window.onload = function() {
            addCourse();
            addCourse();
            addCourse();
        };
    </script>
</body>
</html>
